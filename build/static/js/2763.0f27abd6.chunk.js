"use strict";(self.webpackChunkmy_rsk_wallet_app=self.webpackChunkmy_rsk_wallet_app||[]).push([[2763],{317:(e,t,i)=>{function n(e){return"string"===typeof e?Number.parseInt(e,"0x"===e.trim().substring(0,2)?16:10):"bigint"===typeof e?Number(e):e}i.d(t,{n:()=>n})},42763:(e,t,i)=>{i.d(t,{EmbeddedWalletConnector:()=>k});var n=i(1996),r=i(39917),a=i(317),s=i(25571),o=i(75781),l=i(74534),c=i(10872),d=i(92395),h=i(46494),u=i(78800);const p=()=>{var e;return"true"===localStorage.getItem("IS_THIRDWEB_DEV")?null!==(e=window.localStorage.getItem("THIRDWEB_DEV_URL"))&&void 0!==e?e:"http://localhost:3000":"https://embedded-wallet.thirdweb.com"},g=e=>"thirdwebEwsWalletUserId-".concat(e),w=e=>"".concat("walletToken","-").concat(e),m=(e,t)=>"".concat("a","-").concat(e,"-").concat(t);let I=function(e){return e.COGNITO="Cognito",e.GOOGLE="Google",e.EMAIL_OTP="EmailOtp",e.CUSTOM_JWT="CustomJWT",e.CUSTOM_AUTH_ENDPOINT="CustomAuthEndpoint",e.FACEBOOK="Facebook",e.APPLE="Apple",e.PASSKEY="Passkey",e.EXTERNAL_WALLET="ExternalWallet",e.DISCORD="Discord",e}({}),v=function(e){return e.LOGGED_OUT="Logged Out",e.LOGGED_IN_WALLET_UNINITIALIZED="Logged In, Wallet Uninitialized",e.LOGGED_IN_NEW_DEVICE="Logged In, New Device",e.LOGGED_IN_WALLET_INITIALIZED="Logged In, Wallet Initialized",e}({});const y=new Map;class E{constructor(e){let{clientId:t}=e;this.isSupported=!!window.localStorage,this.clientId=t}async getItem(e){return this.isSupported?window.localStorage.getItem(e):null!==(t=y.get(e))&&void 0!==t?t:null;var t}async setItem(e,t){if(this.isSupported)return window.localStorage.setItem(e,t);y.set(e,t)}async removeItem(e){const t=await this.getItem(e);return!(!this.isSupported||!t)&&(window.localStorage.removeItem(e),!0)}async saveAuthCookie(e){await this.setItem(w(this.clientId),e)}async getAuthCookie(){return this.getItem(w(this.clientId))}async removeAuthCookie(){return this.removeItem(w(this.clientId))}async saveDeviceShare(e,t){await this.saveWalletUserId(t),await this.setItem(m(this.clientId,t),e)}async getDeviceShare(){const e=await this.getWalletUserId();return e?this.getItem(m(this.clientId,e)):null}async removeDeviceShare(){const e=await this.getWalletUserId();return!!e&&this.removeItem(m(this.clientId,e))}async getWalletUserId(){return this.getItem(g(this.clientId))}async saveWalletUserId(e){await this.setItem(g(this.clientId),e)}async removeWalletUserId(){return this.removeItem(g(this.clientId))}}function L(e){return new Promise((t=>{setTimeout(t,1e3*e)}))}const f={height:"100%",width:"100%",border:"none",backgroundColor:"transparent",colorScheme:"light",position:"fixed",top:"0px",right:"0px",zIndex:"2147483646",display:"none"},S=new Map;class b{constructor(e){let{link:t,iframeId:i,container:r=document.body,iframeStyles:a,onIframeInitialize:s}=e;(0,n._)(this,"POLLING_INTERVAL_SECONDS",1.4),this.iframeBaseUrl=p();let o=document.getElementById(i);const l=new URL(t),c="2.5.39";if(l.searchParams.set("sdkVersion",c),!o||o.src!==l.href){if(!o){o=document.createElement("iframe");const e={...f,...a};Object.assign(o.style,e),o.setAttribute("id",i),o.setAttribute("fetchpriority","high"),r.appendChild(o)}o.src=l.href,o.setAttribute("data-version",c);const e=t=>{if("ewsIframeLoaded"===t.data.eventType){if(window.removeEventListener("message",e),!o)return void console.warn("thirdweb Iframe not found");this.onIframeLoadHandler(o,s)()}};window.addEventListener("message",e)}this.iframe=o}async onIframeLoadedInitVariables(){return{}}onIframeLoadHandler(e,t){return async()=>{const i=new Promise((async(i,n)=>{var r;const a=new MessageChannel;a.port1.onmessage=r=>{const{data:s}=r;return a.port1.close(),s.success?(S.set(e.src,!0),t&&t(),i(!0)):n(new Error(s.error))};null===e||void 0===e||null===(r=e.contentWindow)||void 0===r||r.postMessage({eventType:"initIframe",data:await this.onIframeLoadedInitVariables()},this.iframeBaseUrl,[a.port2])}));await i}}async call(e){let{procedureName:t,params:i,showIframe:n=!1}=e;for(;!S.get(this.iframe.src);)await L(this.POLLING_INTERVAL_SECONDS);n&&(this.iframe.style.display="block",await L(.005));const r=new Promise(((e,r)=>{var a;const s=new MessageChannel;s.port1.onmessage=async t=>{const{data:i}=t;s.port1.close(),n&&(await L(.1),this.iframe.style.display="none"),i.success?e(i.data):r(new Error(i.error))},null===(a=this.iframe.contentWindow)||void 0===a||a.postMessage({eventType:t,data:i},this.iframeBaseUrl,[s.port2])}));return r}destroy(){S.delete(this.iframe.src)}}class _ extends b{constructor(e){let{clientId:t,customizationOptions:i}=e;super({iframeId:O,link:W({clientId:t,path:"/sdk/2022-08-12/embedded-wallet",queryParams:i}).href,container:document.body}),this.clientId=t}async onIframeLoadedInitVariables(){const e=new E({clientId:this.clientId});return{authCookie:await e.getAuthCookie(),deviceShareStored:await e.getDeviceShare(),walletUserId:await e.getWalletUserId(),clientId:this.clientId}}}function W(e){let{clientId:t,path:i,queryParams:n}=e;const r=new URL("".concat(i),p());if(n)for(const s of Object.keys(n)){var a;r.searchParams.set(s,(null===(a=n[s])||void 0===a?void 0:a.toString())||"")}return r.searchParams.set("clientId",t),r}const O="thirdweb-embedded-wallet-iframe";class A{constructor(e){let{querier:t,preLogin:i,postLogin:n,clientId:r}=e;this.LoginQuerier=t,this.preLogin=i,this.postLogin=n,this.clientId=r}async sendEmailLoginOtp(e){let{email:t}=e;await this.preLogin();return await this.LoginQuerier.call({procedureName:"sendThirdwebEmailLoginOtp",params:{email:t}})}async sendSmsLoginOtp(e){let{phoneNumber:t}=e;await this.preLogin();return await this.LoginQuerier.call({procedureName:"sendThirdwebSmsLoginOtp",params:{phoneNumber:t}})}}class D extends A{constructor(){super(...arguments),(0,n._)(this,"closeWindow",(e=>{let{isWindowOpenedByFn:t,win:i,closeOpenedWindow:n}=e;t?null===i||void 0===i||i.close():i&&n?n(i):i&&i.close()}))}async getOauthLoginUrl(e){return await this.LoginQuerier.call({procedureName:"getHeadlessOauthLoginLink",params:{authProvider:e}})}async loginWithModal(){await this.preLogin();const e=await this.LoginQuerier.call({procedureName:"loginWithThirdwebModal",params:void 0,showIframe:!0});return this.postLogin(e)}async loginWithEmailOtp(e){let{email:t}=e;await this.preLogin();const i=await this.LoginQuerier.call({procedureName:"loginWithThirdwebModal",params:{email:t},showIframe:!0});return this.postLogin(i)}getOauthPopUpSizing(e){return e===I.FACEBOOK?"width=715, height=555":"width=350, height=500"}async loginWithOauth(e){let t=null===e||void 0===e?void 0:e.openedWindow,i=!1;if(t||(t=window.open("","Login",this.getOauthPopUpSizing(e.oauthProvider)),i=!0),!t)throw new Error("Something went wrong opening pop-up");const[{loginLink:n}]=await Promise.all([this.getOauthLoginUrl(e.oauthProvider),this.preLogin()]);t.location.href=n;const r=await new Promise(((n,r)=>{const a=window.setInterval((async()=>{t&&t.closed&&(clearInterval(a),window.removeEventListener("message",s),r(new Error("User closed login window")))}),1e3),s=async o=>{if(o.origin===p())if("object"===typeof o.data)switch(o.data.eventType){case"userLoginSuccess":window.removeEventListener("message",s),clearInterval(a),this.closeWindow({isWindowOpenedByFn:i,win:t,closeOpenedWindow:null===e||void 0===e?void 0:e.closeOpenedWindow}),o.data.authResult&&n(o.data.authResult);break;case"userLoginFailed":window.removeEventListener("message",s),clearInterval(a),this.closeWindow({isWindowOpenedByFn:i,win:t,closeOpenedWindow:null===e||void 0===e?void 0:e.closeOpenedWindow}),r(new Error(o.data.error));break;case"injectDeveloperClientId":var l;null===(l=t)||void 0===l||l.postMessage({eventType:"injectDeveloperClientIdResult",developerClientId:this.clientId,authOption:e.oauthProvider},p())}else r(new Error("Invalid event data"))};window.addEventListener("message",s)}));return this.postLogin({storedToken:{...r.storedToken,shouldStoreCookieString:!0},walletDetails:{...r.walletDetails,isIframeStorageEnabled:!1}})}async loginWithCustomJwt(e){let{encryptionKey:t,jwt:i}=e;await this.preLogin();const n=await this.LoginQuerier.call({procedureName:"loginWithCustomJwt",params:{encryptionKey:t,jwt:i}});return this.postLogin(n)}async loginWithCustomAuthEndpoint(e){let{encryptionKey:t,payload:i}=e;await this.preLogin();const n=await this.LoginQuerier.call({procedureName:"loginWithCustomAuthEndpoint",params:{encryptionKey:t,payload:i}});return this.postLogin(n)}async verifyEmailLoginOtp(e){let{email:t,otp:i,recoveryCode:n}=e;const r=await this.LoginQuerier.call({procedureName:"verifyThirdwebEmailLoginOtp",params:{email:t,otp:i,recoveryCode:n}});return this.postLogin(r)}async verifySmsLoginOtp(e){let{phoneNumber:t,otp:i,recoveryCode:n}=e;const r=await this.LoginQuerier.call({procedureName:"verifyThirdwebSmsLoginOtp",params:{phoneNumber:t,otp:i,recoveryCode:n}});return this.postLogin(r)}}class C{constructor(e){let{clientId:t,querier:i,onAuthSuccess:n}=e;this.clientId=t,this.AuthQuerier=i,this.localStorage=new E({clientId:t}),this.onAuthSuccess=n,this.BaseLogin=new D({postLogin:async e=>this.postLogin(e),preLogin:async()=>{await this.preLogin()},querier:i,clientId:t})}async preLogin(){await this.logout()}async postLogin(e){let{storedToken:t,walletDetails:i}=e;t.shouldStoreCookieString&&await this.localStorage.saveAuthCookie(t.cookieString);return await this.onAuthSuccess({storedToken:t,walletDetails:i})}async loginWithModal(){return this.BaseLogin.loginWithModal()}async loginWithEmailOtp(e){return this.BaseLogin.loginWithEmailOtp(e)}async loginWithCustomJwt(e){return this.BaseLogin.loginWithCustomJwt(e)}async loginWithCustomAuthEndpoint(e){return this.BaseLogin.loginWithCustomAuthEndpoint(e)}async loginWithOauth(e){return this.BaseLogin.loginWithOauth(e)}async sendEmailLoginOtp(e){let{email:t}=e;return this.BaseLogin.sendEmailLoginOtp({email:t})}async sendSmsLoginOtp(e){let{phoneNumber:t}=e;return this.BaseLogin.sendSmsLoginOtp({phoneNumber:t})}async verifyEmailLoginOtp(e){return this.BaseLogin.verifyEmailLoginOtp(e)}async verifySmsLoginOtp(e){return this.BaseLogin.verifySmsLoginOtp(e)}async logout(){const{success:e}=await this.AuthQuerier.call({procedureName:"logout",params:void 0}),t=await this.localStorage.removeAuthCookie(),i=await this.localStorage.removeWalletUserId();return{success:e||t||i}}}class N extends c.Signer{constructor(e){var t;let{provider:i,clientId:r,querier:a}=e;super(),(0,n._)(this,"DEFAULT_ETHEREUM_CHAIN_ID",5),this.clientId=r,this.querier=a,this.endpoint=null===(t=i.connection)||void 0===t?void 0:t.url,(0,h.defineReadOnly)(this,"provider",i)}async getAddress(){const{address:e}=await this.querier.call({procedureName:"getAddress",params:void 0});return e}async signMessage(e){var t,i,n;const{signedMessage:r}=await this.querier.call({procedureName:"signMessage",params:{message:e,chainId:null!==(t=null===(i=await(null===(n=this.provider)||void 0===n?void 0:n.getNetwork()))||void 0===i?void 0:i.chainId)&&void 0!==t?t:this.DEFAULT_ETHEREUM_CHAIN_ID,rpcEndpoint:this.endpoint}});return r}async signTransaction(e){var t,i,n;const{signedTransaction:r}=await this.querier.call({procedureName:"signTransaction",params:{transaction:e,chainId:null!==(t=null===(i=await(null===(n=this.provider)||void 0===n?void 0:n.getNetwork()))||void 0===i?void 0:i.chainId)&&void 0!==t?t:this.DEFAULT_ETHEREUM_CHAIN_ID,rpcEndpoint:this.endpoint}});return r}async sendTransaction(e){if(!this.provider)throw new Error("Provider not found");const t={...await(0,u.g)(this.provider),...e};return super.sendTransaction(t)}async _signTypedData(e,t,i){var n,r,a;const{signedTypedData:s}=await this.querier.call({procedureName:"signTypedDataV4",params:{domain:e,types:t,message:i,chainId:null!==(n=null===(r=await(null===(a=this.provider)||void 0===a?void 0:a.getNetwork()))||void 0===r?void 0:r.chainId)&&void 0!==n?n:this.DEFAULT_ETHEREUM_CHAIN_ID,rpcEndpoint:this.endpoint}});return s}connect(e){return new N({clientId:this.clientId,provider:e,querier:this.querier})}}class T{constructor(e){let{clientId:t,chain:i,querier:n}=e;this.clientId=t,this.chain=i,this.walletManagerQuerier=n,this.localStorage=new E({clientId:t})}async postWalletSetUp(e){let{deviceShareStored:t,walletAddress:i,isIframeStorageEnabled:n,walletUserId:r}=e;return n||await this.localStorage.saveDeviceShare(t,r),{walletAddress:i}}async getUserWalletStatus(){const e=await this.walletManagerQuerier.call({procedureName:"getUserStatus",params:void 0});return e.status===v.LOGGED_IN_WALLET_INITIALIZED?{status:v.LOGGED_IN_WALLET_INITIALIZED,...e.user,wallet:this}:e.status===v.LOGGED_IN_NEW_DEVICE||e.status===v.LOGGED_IN_WALLET_UNINITIALIZED?{status:v.LOGGED_IN_WALLET_UNINITIALIZED,...e.user}:{status:e.status}}async setChain(e){let{chain:t}=e;this.chain=t}async getEthersJsSigner(e){var t;return new N({clientId:this.clientId,provider:(0,d.getDefaultProvider)(null!==(t=null===e||void 0===e?void 0:e.rpcEndpoint)&&void 0!==t?t:l.J6[this.chain]),querier:this.walletManagerQuerier})}}class U{isClientIdLegacyPaper(e){return e.indexOf("-")>0&&36===e.length}constructor(e){let{clientId:t,chain:i,styles:n,onAuthSuccess:r}=e;if(this.isClientIdLegacyPaper(t))throw new Error("You are using a legacy clientId. Please use the clientId found on the thirdweb dashboard settings page");this.clientId=t,this.querier=new _({clientId:t,customizationOptions:n}),this.wallet=new T({clientId:t,chain:i,querier:this.querier}),this.auth=new C({clientId:t,querier:this.querier,onAuthSuccess:async e=>(null===r||void 0===r||r(e),await this.wallet.postWalletSetUp({...e.walletDetails,walletUserId:e.storedToken.authDetails.userWalletId}),await this.querier.call({procedureName:"initIframe",params:{deviceShareStored:e.walletDetails.deviceShareStored,clientId:this.clientId,walletUserId:e.storedToken.authDetails.userWalletId,authCookie:e.storedToken.cookieString}}),{user:{status:v.LOGGED_IN_WALLET_INITIALIZED,authDetails:e.storedToken.authDetails,wallet:this.wallet,walletAddress:e.walletDetails.walletAddress}})})}async getUser(){return this.wallet.getUserWalletStatus()}}i(37380);class k extends o.C{constructor(e){super(),(0,n._)(this,"id",s.w.paper),(0,n._)(this,"name","Embedded Wallet"),(0,n._)(this,"ready",!0),(0,n._)(this,"user",null),(0,n._)(this,"onAccountsChanged",(async e=>{0===e.length?await this.onDisconnect():this.emit("change",{account:r.getAddress(e[0])})})),(0,n._)(this,"onChainChanged",(e=>{const t=(0,a.n)(e),i=-1===this.options.chains.findIndex((e=>e.chainId===t));this.emit("change",{chain:{id:t,unsupported:i}})})),(0,n._)(this,"onDisconnect",(async()=>{this.emit("disconnect")})),this.options=e}getEmbeddedWalletSDK(){return this._embeddedWalletSdk||(this._embeddedWalletSdk=new U({clientId:this.options.clientId,chain:"Ethereum",onAuthSuccess:this.options.onAuthSuccess})),this._embeddedWalletSdk}async connect(e){if(e){if(!e.authResult)throw new Error("Missing authData - call authenticate() first with your authentication strategy");if(!e.authResult.user)throw new Error("Missing authData.user - call authenticate() first with your authentication strategy");this.user=e.authResult.user}else{const e=await this.authenticate({strategy:"iframe"});if(!e.user)throw new Error("Error connecting User");this.user=e.user}return null!==e&&void 0!==e&&e.chainId&&this.switchChain(e.chainId),this.getAddress()}async disconnect(){const e=this._embeddedWalletSdk;await(null===e||void 0===e?void 0:e.auth.logout()),this._signer=void 0,this._embeddedWalletSdk=void 0,this.user=null}async getAddress(){if(!this.user)throw new Error("Embedded Wallet is not connected");return await this.getSigner().then((e=>e.getAddress()))}async isConnected(){try{return!!await this.getAddress()}catch(e){return!1}}async getProvider(){const e=await this.getSigner();if(!e.provider)throw new Error("Provider not found");return e.provider}async getSigner(){if(this._signer)return this._signer;const e=await this.getUser(),t=await e.wallet.getEthersJsSigner({rpcEndpoint:this.options.chain.rpc[0]||""});if(!t)throw new Error("Signer not found");return this._signer=t,t}async isAuthorized(){return!1}async switchChain(e){const t=this.options.chains.find((t=>t.chainId===e));if(!t)throw new Error("Chain not configured");try{var i,n;await(null===(i=this.user)||void 0===i?void 0:i.wallet.setChain({chain:"Ethereum"})),this._signer=await(null===(n=this.user)||void 0===n?void 0:n.wallet.getEthersJsSigner({rpcEndpoint:t.rpc[0]||""})),this.emit("change",{chain:{id:e,unsupported:!1}})}catch(r){console.warn("Failed to switch chain",r)}}async setupListeners(){return Promise.resolve()}updateChains(e){this.options.chains=e}async getUser(){if(!this.user||!this.user.wallet||!this.user.wallet.getEthersJsSigner){const e=this.getEmbeddedWalletSDK(),t=await e.getUser();if(t.status!==v.LOGGED_IN_WALLET_INITIALIZED)throw new Error("Embedded Wallet is not authenticated, please authenticate first");this.user=t}return this.user}async getEmail(){return(await this.getUser()).authDetails.email}async getPhoneNumber(){return(await this.getUser()).authDetails.phoneNumber}async getRecoveryInformation(){return(await this.getUser()).authDetails}async sendVerificationEmail(e){let{email:t}=e;return this.getEmbeddedWalletSDK().auth.sendEmailLoginOtp({email:t})}async sendVerificationSms(e){let{phoneNumber:t}=e;return this.getEmbeddedWalletSDK().auth.sendSmsLoginOtp({phoneNumber:t})}async authenticate(e){const t=this.getEmbeddedWalletSDK(),i=e.strategy;switch(i){case"email_verification":return await t.auth.verifyEmailLoginOtp({email:e.email,otp:e.verificationCode,recoveryCode:e.recoveryCode});case"phone_number_verification":return await t.auth.verifySmsLoginOtp({phoneNumber:e.phoneNumber,otp:e.verificationCode,recoveryCode:e.recoveryCode});case"apple":case"facebook":case"google":{const n=P[i];return t.auth.loginWithOauth({oauthProvider:n,closeOpenedWindow:e.closeOpenedWindow,openedWindow:e.openedWindow})}case"jwt":return t.auth.loginWithCustomJwt({jwt:e.jwt,encryptionKey:e.encryptionKey});case"auth_endpoint":return t.auth.loginWithCustomAuthEndpoint({payload:e.payload,encryptionKey:e.encryptionKey});case"iframe_email_verification":return t.auth.loginWithEmailOtp({email:e.email});case"iframe":return t.auth.loginWithModal();default:!function(e){throw new Error("Invalid param: "+e)}(i)}}}const P={google:I.GOOGLE,facebook:I.FACEBOOK,apple:I.APPLE}},74534:(e,t,i)=>{i.d(t,{J6:()=>n,mb:()=>r});var n={Ethereum:"https://ethereum.rpc.thirdweb.com",Goerli:"https://goerli.rpc.thirdweb.com",Mumbai:"https://mumbai.rpc.thirdweb.com",Polygon:"https://polygon.rpc.thirdweb.com",Avalanche:"https://avalanche.rpc.thirdweb.com",Optimism:"https://optimism.rpc.thirdweb.com",OptimismGoerli:"https://optimism-goerli.rpc.thirdweb.com",BSC:"https://binance.rpc.thirdweb.com",BSCTestnet:"https://binance-testnet.rpc.thirdweb.com",ArbitrumOne:"https://arbitrum.rpc.thirdweb.com",ArbitrumGoerli:"https://arbitrum-goerli.rpc.thirdweb.com",Fantom:"https://fantom.rpc.thirdweb.com",FantomTestnet:"https://fantom-testnet.rpc.thirdweb.com",Sepolia:"https://sepolia.rpc.thirdweb.com",AvalancheFuji:"https://avalanche-fuji.rpc.thirdweb.com"},r=()=>{var e;return"undefined"!=typeof window&&"true"===window.localStorage.getItem("IS_PAPER_DEV")?null!=(e=window.localStorage.getItem("PAPER_DEV_URL"))?e:"http://localhost:3000":"undefined"!=typeof window&&window.location.origin.includes("paper.xyz")||"undefined"!=typeof window&&window.location.origin.includes("thirdweb.com")?window.location.origin:"https://withpaper.com"}}}]);
//# sourceMappingURL=2763.0f27abd6.chunk.js.map